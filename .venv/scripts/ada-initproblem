#!/usr/bin/env python3
import os
from sys import argv

# Constants
ADAENVVAR = "ADAVENVSET"
DOWNLOAD_URL = "https://aceptaelreto.com/pub/problems/v00{0}/{1}/sam/sample{2}.zip"
GET_URL = lambda p: DOWNLOAD_URL.format(p[0], p[1:], p)

# Check if ada is set
if not os.environ.get("ADAVENVSET"):
    print(f"start the virtual enviroment first")

# Check if args are correct
if len(argv) not in (2, 3):
    print(f"{argv[0]} <problem n> [input type]")

problem = argv[1]
inputtype = 0 if len(argv) == 2 else int(argv[2])

def copy_template(inputtype: int, name:str = "main.cpp"):
    os.system(f"cp ${ADAENVVAR}/templates/input{inputtype}.cpp {name}")
    os.system(f"cp ${ADAENVVAR}/templates/makefile makefile")

## Do everything
# Make folder, download, move, extract, move samples, delete
os.system(f"mkdir p{problem}") 
os.system(f"wget \"{GET_URL(problem)}\"")
os.system(f"mv sample{problem}.zip p{problem}")
os.chdir(f"p{problem}")
os.system(f"unzip sample{problem}.zip")
os.system(f"rm -r sample{problem}.zip")

# Copy template
if len(argv) == 2:
    # Copy every template
    for i in (1, 2, 3):
        copy_template(i, f"main{i}.cpp")
else:
    copy_template(int(argv[2]))


